<HTML>
<HEAD> <TITLE> ChiWriter to RTF Converter (Russian, Win-1251) </TITLE></HEAD>
<BODY>

<FONT SIZE=+2> <B> Описание программы Chi2word </B> </FONT><P>
<HR>

<FONT SIZE=+1> 
	<B>0.</B> <a href="#par_0">Общие замечания </a><BR>
	<B>1.</B> <a href="#par_1">Что программа делает </a><BR>
	<B>2.</B> <a href="#par_2">Что программа умеет и чего не умеет </a><BR>
</FONT>
	&nbsp;&nbsp;&nbsp;&nbsp;<B>2.1.</B> <a href="#par_2_1">Что программа умеет </a><BR>
	&nbsp;&nbsp;&nbsp;&nbsp;<B>2.2.</B> <a href="#par_2_2">Чего программа не умеет </a><BR>
<FONT SIZE=+1> 
	<B>3.</B> <a href="#par_3">Описание шрифтов </a><BR>
</FONT>
	&nbsp;&nbsp;&nbsp;&nbsp;<B>3.1.</B> <a href="#par_3_1">Общие замечания </a><BR>
	&nbsp;&nbsp;&nbsp;&nbsp;<B>3.2.</B> <a href="#par_3_2">Описание формата файлов <TT>*.WIN</TT> </a><BR>
<FONT SIZE=+1> 
	<B>4.</B> <a href="#par_5">Комплект поставки</a><BR>
	<B>5.</B> <a href="#par_5">Разное</a> <BR>
</FONT><P>

<FONT SIZE=+1> <B> 
<a name="par_0">
0. Общие замечания 
</B> </FONT><P>

0.1. Программа писалась для себя. Этим объясняются убогость диагностики 
и скудость комментариев в исходном тексте. <I> C'est la vie</I>. <P>

0.2. Как все кайрайтерное, программа требует муторной настройки 
на шрифты. Cоветую не лениться: даже если в полученной Вами пачке 
файлов есть описания для шрифтов с Вашими именами - проверить еще 
раз, те ли это шрифты. В шрифтах от ChiWriter стандартности столько 
же, сколько в осколках от чашки: если не от одной и той же - никогда 
не подойдут, как бы похожи ни были. <P>

0.3. Программа делалась для применения в конкретной задаче: 
перевод в приличный вид очень большого массива текстов по лингвистике. 
Отсюда - внимание к текстовому оформлению и небрежная работа со сложными 
индексами. Это несложно исправить; желающие - читайте исходный код. <P>

0.4. Все замечания, предложения и т.п. просьба направлять мне - Николаю 
Григорьеву по адресу <a href="mailto:grig@iitp.ru"> grig@iitp.ru</a>.
Вправду, не стесняйтесь, обращайтесь - буду рад. Ну а если кто-то вдруг 
решится добавить недостающие функции (обработку таблиц, составных 
символов и т.п.) - большая просьба поделиться исходным текстом. <P>

0.5. <B>(disclaimer)</B>. Вот Вам программа, вот Вам текст, делайте со 
всем этим что хотите. Но если что-нибудь случится - я не виноват! 
Единственная просьба: будете кому-нибудь ее давать - обязательно отдайте 
исходный текст и эту вот инструкцию. <P>


<FONT SIZE=+1> <B> 
<a name="par_1">
1. Что программа делает
</B></FONT><P>

Программа по мере сил переводит файлы из формата ChiWriter 3.1* 
в формат RTF (в варианте Word&nbsp;6.0 / Word&nbsp;95 / Word&nbsp;97). У командной 
строки - два аргумента: имя файла ChiWriter (обязательный) и имя 
выходного файла (необязательный). Никакого расширения по умолчанию 
для входного имени нет, так что расширение тоже надо указывать. 
Если имя выходного файла не задано, то оно делается из имени 
входного заменой его расширения на&nbsp;<B><TT>.RTF</TT></B>.<P>

Для работы программы сам ChiWriter не нужен, но нужно описание
используемых ChiWriter'ных шрифтов. Как его составить и куда 
положить - см.&nbsp;<a href="#par_3">п.&nbsp;3</a>. <P>

<FONT SIZE=+1> <B> 
<a name="par_2">
2. Что программа умеет и чего не умеет
</B></FONT><P>

2.1. <a name="par_2_1"> <B> Программа умеет: </B><P>

<UL>
<LI> переводить <U>абзацы</U> ChiWriter в абзацы RTF;<P>

<LI> заменять <U>символы</U> ChiWriter на символы из TrueType-шрифтов 
     в соответствии с файлом описания шрифта;<P>

<LI> обрабатывать <U>верхние и нижние индексы</U>;<P>

<LI> убирать <U>мягкие пробелы</U>;<P>

<LI> обрабатывать <U>переносы</U> (при условии, что они сделаны через
     форматирование абзаца); <P>

<LI> обрабатывать <U>подстрочные сноски</U>;<P>

<LI> обрабатывать <U>колонтитул по умолчанию</U> (в частности, вставлять 
     <U>номер страницы</U>);<P>

<LI> обычно правильно определять <U>межстрочный интервал</U> в абзаце, 
     <U>отступ</U> перед/после абзаца и <U>центровку</U>;<P>

<LI> обрабатывать <U>разрядку</U>, сделанную с применением невидимых 
     символов ChiWriter (вместо них можно вставить неразрывные 
     пробелы).<P>
</UL><P>

2.2. <a name="par_2_2"> <B> Программа не умеет: </B><P>
<UL>
<LI>
  обрабатывать <U>составные символы</U>. Т.е. если французская буква 
  сделана Вами из английской довешиванием надстрочного значка 
  прямо сверху, то описать замену этой группы на единую букву 
  не удастся. Вместо этого произойдет следующее: оба символа 
  прочтутся по своим правилам и возникнут в тексте в окружении 
  специальных скобок <TT>&lt;! ... !&gt;</TT>. Самое обидное для Вас заключается 
  в том, что если в одной колонке попадаются и верхние, и нижние 
  индексы, то они тоже будут обработаны таким образом. Если это 
  сильно мешает, можно усложнить работу с индексами в самой 
  программе: интересующимся я готов помочь в этом вопросе. 
  Впрочем, для банального случая одновременного наличия 
  однобуквенных индексов сверху и снизу достаточно просто удалить 
  эти самые скобки, и результат будет вполне пристойный.
  <P>
  (Самым правильным путем решения этих проблем будет написать 
  макрос на Word Basic, который будет отыскивать выражения в этих 
  специальных скобках и заменять их на то, что нужно. Написать его, 
  ей-богу, несложно, но для моих текстов это не нужно, поэтому мне 
  и недосуг.) <P>

<LI>
  обрабатывать специальным образом <U>таблицы, графику и многоэтажные 
  формулы</U>. Они обрабатываются так, как если бы они были составлены 
  из обычных символов в соответствии с их описаниями; результат в 
  большинстве случаев грубо неправильный. Особенно дико выглядят 
  таблицы: если, как это часто бывает, таблица сделана на одной 
  очень широкой строке, то все расположенное в одной колонке 
  считается индексами и пишется в пресловутые скобки <TT>&lt;! ... !&gt;</TT>. 
  Это настолько ужасно, что я рекомендую как-то препарировать 
  таблицы, прежде чем отдавать их на съедение программе. Например, 
  можно сделать каждую клетку таблицы отдельным абзацем, а потом 
  в Word преобразовать соответствующую часть обратно в таблицу -
  благо, это можно сделать автоматически.<P>

<LI>
  обрабатывать <U>множественные колонтитулы</U> (т.е. все, кроме общего); <P>

<LI>
  отличать <U>текст, выровненный по правому краю</U>.
</UL><P>

<FONT SIZE=+1> <B> 
<a name="par_3">
3. Описание шрифтов
</B></FONT><P>

3.1. <a name="par_3_1">
Для шрифта с именем <TT>ABCXYZ</TT> файл описания должен называться
<TT>ABCXYZ.WIN</TT> (т.е. приделывается расширение <TT>.WIN</TT>) и располагаться 
либо в текущей директории, либо в директории ChiWriter (т.е. 
обозначенной в переменной окружения <TT><B>CHIFILES</B></TT>). Если Вам надо 
просто перекодировать много файлов в одном месте - удобнее первое 
(поскольку в директории ChiWriter эти файлы потом не найдешь); 
если это постоянно надо делать в разных директориях - второе. 
По переменной <TT><B>PATH</B></TT> программа и не думает что-либо искать: если 
Вам надо - добавьте сами.

Кроме того, нужно обязательно определить два вспомогательных 
файла описания шрифта: <TT>STANDARD.WIN</TT> (он же по совместительству 
файл стандартного шрифта) и <TT>LACKING.WIN</TT> (файл отсутствующего 
шрифта). Они нужны для аварийной работы. <P>

<TT><B>STANDARD.WIN</B></TT> используется для борьбы с ошибкой ChiWriter'а, 
состоящей в том, что шрифт используется, а имя его в файл не 
записывается. Это довольно распространенное явление, хотя его 
трудно заметить, когда сидишь все время на одной машине с 
одним и тем же <TT>CONFIG.PAR</TT>. Если в ходе работы программы Вы 
получаете сообщение типа <I>&quot;Font&nbsp;F49 has no name; using STANDARD 
instead&quot;</I>, то это как раз ваш случай. Если в Вашем тексте символов 
из F49 мало, можете проигнорировать сообщение; тогда вместо F49 
подставится <TT>STANDARD</TT>. Если вам не все равно, чините Ваш 
ChiWriter'ный файл: откройте его ASCII-редактором и найдите 
в его начале строчки типа <TT><B>&quot;\U!&nbsp;STANDARD&quot;</B></TT>. Просмотрите все 
строчки, начинающиеся на <TT><B>\U</B></TT>: нет ли среди них строчки, в 
которой не хватает имени шрифта. Если такое есть - впишите. 
(Номер шрифта можно выяснить самой программой перекодировки: 
она жалуется на такие случаи в порядке их появления в файле). <P>

<TT><B>LACKING.WIN</B></TT> используется для борьбы с неописанными шрифтами 
(т.е. если <TT>ABCXYZ.WIN</TT> не найден). Сделайте его таким, чтобы 
потом легко найти все вхождения его результатов в готовом 
файле Word: см. имеющийся <TT>LACKING.WIN</TT>.<P>

<B> <a name="par_3_2">
3.2. Формат файлов <TT>*.WIN</TT>
</B><P>
Файл описания шрифта - обычный ASCII файл.
В нем бывает три типа строк: 
<I>
<UL>
<LI> комментарии;
<LI> параметры; 
<LI> таблица перекодировки.
</UL><P>
</I>

<I> Комментарий </I> - любая строка, начинающаяся с двух диезов (<TT>##</TT>). <P>

<I> Параметр </I> - строка, имеющая вид: <TT><B> <I>&lt;имя&gt;</I> = <I>&lt;значение&gt;</I> </B></TT>
Пробелов в начале строки быть не должно.
Строчные и заглавные буквы не различаются. <P>
<U>Допустимые параметры и их возможные значения:</U><P>

<TABLE BORDER=0 WIDTH="100%" BGCOLOR="LIGHTGREY"><TR><TD>
<TT><B> 
FONT=<I>&lt;имя шрифта Windows&gt;</I> [, <I>&lt;номер набора символов&gt;</I>]
</B></TT>
</TD></TR></TABLE>

Задает шрифт Windows, которым будут передаваться символы данного 
шрифта ChiWriter. После имени шрифта через запятую можно приписать
номер символьного набора (<I>charset</I>); для русских шрифтов Windows
номер набора = 204. Если charset не указан, то используется 0 
(он же Western). <P>
В Word&nbsp;6.0/95 можно было не указывать номер набора для шрифтов типа
Arial&nbsp;Cyr (т.е. определенных через Font Substitutes). К сожалению,
Word&nbsp;97 в этом месте содержит ошибку (игнорирует Font Substitutes),
и обойтись без явного указания charset не удается. Поэтому
рекомендуется приписывать 204 ко всем именам русских шрифтов. <P>

<TABLE BORDER=0 WIDTH="100%" BGCOLOR="LIGHTGREY"><TR><TD>
<TT><B>
ATTR=none<BR>
ATTR=Bold<BR>
ATTR=Italic<BR>
ATTR=Underline<BR>
ATTR=Shadow<BR>
ATTR=Outline<BR>
ATTR=Strike
</B></TT>
</TD></TR></TABLE>

Атрибуты шрифта Windows (кажется, ясно, какой где). Можно писать
сразу несколько через запятую. <P> 

<TABLE BORDER=0 WIDTH="100%" BGCOLOR="LIGHTGREY"><TR><TD>
<TT><B>
SIZE=<I>&lt;кегль шрифта Windows&gt;</I>
</B></TT>
</TD></TR></TABLE>
Размер шрифта (тот, который возникнет в Word) <P>

<TABLE BORDER=0 WIDTH="100%" BGCOLOR="LIGHTGREY"><TR><TD>
<TT><B>
INDEX_SIZE=<I>&lt;кегль шрифта Windows&gt;</I>
</B></TT>
</TD></TR></TABLE>
Размер шрифта для случая, когда символ возникает не в основной 
строчке, а в индексе. В ChiWriter сплошь и рядом индексы того же
размера, что и основной текст; при переносе их можно сделать поменьше. <P>

<TABLE BORDER=0 WIDTH="100%" BGCOLOR="LIGHTGREY"><TR><TD>
<TT><B>
DEFSYMBOL=<I>&lt;символ&gt;</I>
</B></TT>
</TD></TR></TABLE>
Символ, используемый для всего, что не упомянуто в таблице 
перекодировки (см. ниже). Формат - тот же, что и для выходных
символов в этой таблице. <P>

Любая строка, не начинающаяся со знака комментария или ключевого 
слова-параметра, считается относящейся к <I>таблице перекодировки</I>.
В ней должно быть записано одна или несколько пар перекодировки.
Пара состоит из входного символа (того, который в ChiWriter) и 
выходного символа. Входной символ задается сам собой. Выходной можно 
написать либо прямо, либо в виде кода. Код должен содержать ровно 
три цифры, интерпретируемые как десятичное число (так, как это принято 
в файле описания принтера для ChiWriter). Есть также два специальных 
символа - пробел (<TT><B>SP</B></TT> или <TT><B>SPACE</B></TT>) 
и неразрывный пробел (<TT><B>NBSP</B></TT> или <TT><B>NONBREAK-SPACE</B></TT>). 
<P>

<I>Способ интерпретации</I> файла описания следующий:
<UL>
<LI>
  Если строка параметра указана в начале файла (т.е. раньше всех строк 
  перекодировки), то параметр будет действовать по умолчанию для всех 
  символов, для которых не указано иное. Параметр <TT><B>DEFSYMBOL</B></TT> действует 
  только если он стоит до первой строки таблицы перекодировки, в
  противном случае (и при его отсутствии) код символа не меняется.<P>

<LI>
  Если строка параметров встречается не в начале (т.е. выше ее есть
  строки перекодировки), то ее действие распространяется только на те
  символы, которые указаны в таблице перекодировки ниже ее.
</UL> <P>

Рекомендуется посмотреть, как сделаны файлы <TT>STANDARD.WIN</TT> (обычный
латинский шрифт), <TT>BOLD__R.WIN</TT> (полужирная кириллица) и <TT>MATH.WIN</TT>
(спецсимволы); многое станет ясно. Полезно также глянуть (и, если 
надо, переделать) <TT>LACKING.WIN</TT>. <P>

Просматривать и редактировать эти файлы проще под Windows - через 
Notepad (Блокнот): под DOS'ом таблица перекодировки кириллицы 
читается с трудом, а под Windows имеет вполне прозрачную структуру. 
Кроме того, опыт показывает, что при составлении новых описаний 
приходится часто лазить в Character Map (Таблицу Символов). <P>

<FONT SIZE=+1> <B> 
<a name="par_4">
4. Комплект поставки
</B></FONT><P>

У Вас должно быть:
<UL>
<LI> <TT><B>Chi2word.exe </B></TT>- сама программа (консольное приложение Win32);
<LI> <TT><B>Chi2word.c</B></TT>   - исходный текст на C;
<LI> <TT><B>Chi2word.htm</B></TT> - инструкция (то, что Вы сейчас читаете);
<LI> несколько файлов с расширением <TT>*.WIN</TT> - описания шрифтов, сделанные
     до сих пор. Их полезно посмотреть, но доверять им не стоит - многие
     я сделал не имея самих шрифтов, просто для того, чтобы как-то прочесть 
     нечитаемые файлы ChiWriter.
</UL> <P>

<FONT SIZE=+1> <B> 
<a name="par_5">
5. Разное 
</B></FONT><P>

5.1. Если Вам часто приходится перекодировать файлы и Вы составили 
приличное описание Ваших шрифтов, то под Windows&nbsp;95/NT&nbsp;4.0 удобно 
бывает добавить конвертирование в контекстное меню Explorer
(Проводника) для файлов ChiWriter, так чтобы вызывать конвертер 
правой кнопкой мышки. Те, кто не знает, как это делается - могут 
спросить у меня. <P>

5.2. Программа написана на чистейшем С и откомпилирована <B>Visual&nbsp;C++&nbsp;5.0</B>
как консольное приложение Win32. Страдальцы, сидящие на 286 машинах 
под DOS, могут перекомпилировать его в <B>Turbo&nbsp;C&nbsp;2.0</B> (на котором эта 
программа во время оно и была создана): работать будет, я проверял. 
Не забудьте только раскомментировать <TT> #include&nbsp;&lt;alloc.h&gt;</TT>.
</BODY></HTML>
